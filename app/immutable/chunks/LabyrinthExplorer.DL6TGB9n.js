var e=Object.defineProperty,t=(t,s,o)=>((t,s,o)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o)(t,"symbol"!=typeof s?s+"":s,o);import{s,p as o,e as r,a as n,t as l,c as a,b as c,m as i,f as u,g as h,d,h as f,i as g,j as p,r as m,q as v,k as w,o as b,w as y,Y as x,n as k}from"./scheduler.Cp4pqcvj.js";import{S,i as E,f as C,b as I,d as P,m as D,t as j,a as $,e as V}from"./index.BnBan4aP.js";import{e as G}from"./each.BwHC6aEM.js";import{g as T}from"./stores.CmumhmVx.js";import"./ProgressBar.svelte_svelte_type_style_lang.CTnzKPtJ.js";import{H as N,s as O}from"./HighlightCodeEditor.CWrL3l1_.js";function R(e){return{r:1===parseInt(e[0]),b:1===parseInt(e[1])}}var M=(e=>(e.Up="up",e.Right="right",e.Down="down",e.Left="left",e))(M||{});const W={up:"↑",down:"↓",left:"←",right:"→"};class L{constructor(e){t(this,"workerScript"),t(this,"webWorker",null),t(this,"workerBlob"),t(this,"timeoutSec",5),t(this,"timeoutId",null),this.workerScript='// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\n\nlet isProgress = true;\n\nself.onmessage = async function (event) {\n  const { code, allowedGlobals } = event.data;\n  if (typeof allowedGlobals !== "string") {\n    throw new Error("allowedGlobals must be a serialized string.");\n  }\n\n  const workerScope = self;\n  const commonModules = Object.getOwnPropertyNames(workerScope).reduce((acc, key) => {\n    if (key in workerScope) {\n      const value = workerScope[key];\n      const type = typeof value;\n      if (type === "function" || type === "object") acc[key] = value;\n    }\n    return acc;\n  }, {});\n  commonModules.setTimeout = setTimeout.bind(self);\n\n  const createCustomFunction = (key, value) => {\n    return async (...args) => {\n      const argsWithoutFunction = args.filter((arg) => typeof arg !== "function");\n      self.postMessage({ type: "invoke", functionName: key, args: argsWithoutFunction });\n      await new Promise((resolve) => setTimeout(resolve, value.wait));\n    };\n  };\n\n  let commonGlobals = {};\n  let customGlobals = {};\n  try {\n    const parsedGlobals = JSON.parse(allowedGlobals);\n    for (const [key, value] of Object.entries(parsedGlobals)) {\n      if (key in commonModules) {\n        commonGlobals[key] = commonModules[key];\n      } else {\n        customGlobals[key] = createCustomFunction(key, value);\n      }\n    }\n  } catch {\n    throw new Error("Failed to parse allowedGlobals.");\n  }\n  const globals = { ...commonGlobals, ...customGlobals };\n\n  const proxy = new Proxy(globals, {\n    has: (target, key) => {\n      if (key in target) return true;\n      throw new Error(`"${String(key)}" is not exist or not allowed.`);\n    },\n    get: (target, key) => {\n      return key in target ? target[key] : undefined;\n    },\n  });\n\n  const wrappedCode = (userCode) => `\nwith (proxy) {\n  return (async () => {\n    ${userCode}\n  })(); \n}\n`;\n\n  const replacedCode = (userCode) => {\n    let replacedCode = userCode;\n    for (const key of Object.keys(customGlobals)) {\n      const regex = new RegExp(`(?<!\\\\.)\\\\b${key}\\\\b\\\\(([^)]*)\\\\)`, "g");\n      replacedCode = replacedCode.replace(regex, `await ${key}($1)`);\n    }\n    return replacedCode;\n  };\n\n  const executeCode = async () => {\n    try {\n      const result = await new Function("proxy", wrappedCode(replacedCode(code)))(proxy);\n      isProgress = false;\n      self.postMessage({ result: result ?? null });\n    } catch (error) {\n      isProgress = false;\n      self.postMessage({ error: error instanceof Error ? error.message : "UnknownError" });\n    }\n  };\n\n  const executeRecursiveLoop = () => {\n    if (isProgress) {\n      executeCode().then(() => {\n        setTimeout(executeRecursiveLoop, 0);\n      });\n    }\n  };\n  executeRecursiveLoop();\n};\n',this.workerBlob=new Blob([this.workerScript],{type:"application/javascript"}),this.timeoutSec=e||this.timeoutSec}get worker(){return null===this.webWorker&&(this.webWorker=new Worker(URL.createObjectURL(this.workerBlob))),this.webWorker}run(e,t,s){if(""===e)return void s({status:"Warning",resultString:"",message:"Code is empty."});this.timeoutId=setTimeout((()=>{console.warn(`Web Worker time out. (${this.timeoutSec} sec)`),s({status:"Warning",resultString:"",message:`Time out. (${this.timeoutSec} sec)`}),this.terminate()}),1e3*this.timeoutSec),this.worker.onmessage=e=>{this.timeoutId&&(this.timeoutId=null),this.handleWorkerMessage(e,t,s)};const o=JSON.stringify(t,((e,t)=>"function"==typeof t?t.toString():t));this.worker.postMessage({code:e,allowedGlobals:o})}formatResultToString(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)||"object"==typeof e?JSON.stringify(e,null,2):"(No Results)"}handleWorkerMessage(e,t,s){const{type:o,functionName:r,args:n,result:l,error:a}=e.data;if("invoke"===o){const{func:e}=t[r];"function"==typeof e&&e(...n)}else void 0!==l?(s({status:"Succeed",resultString:this.formatResultToString(l),message:"Executed successfully."}),this.terminate()):a?(console.error("Error:",a),s({status:"Error",resultString:"",message:a}),this.terminate()):console.warn("Unknown message type received from worker:",e.data)}terminate(){this.timeoutId&&clearTimeout(this.timeoutId),this.worker.terminate(),this.webWorker=null}}function F(e,t,s){const o=e.slice();return o[2]=t[s],o}function z(e,t,s){const o=e.slice();return o[26]=t[s],o[28]=s,o}function A(e,t,s){const o=e.slice();return o[29]=t[s],o[31]=s,o}function B(e){let t,s;return{c(){t=r("div"),s=r("span"),s.textContent="S",this.h()},l(e){t=a(e,"DIV",{class:!0});var o=c(t);s=a(o,"SPAN",{class:!0,"data-svelte-h":!0}),"svelte-1kggcyi"!==i(s)&&(s.textContent="S"),o.forEach(h),this.h()},h(){f(s,"class","text-blue-500"),f(t,"class",K)},m(e,o){g(e,t,o),p(t,s)},p:k,d(e){e&&h(t)}}}function U(e){let t,s;return{c(){t=r("div"),s=r("span"),s.textContent="G",this.h()},l(e){t=a(e,"DIV",{class:!0});var o=c(t);s=a(o,"SPAN",{class:!0,"data-svelte-h":!0}),"svelte-4qjfye"!==i(s)&&(s.textContent="G"),o.forEach(h),this.h()},h(){f(s,"class","text-blue-500"),f(t,"class",K)},m(e,o){g(e,t,o),p(t,s)},p:k,d(e){e&&h(t)}}}function H(e){let t,s,o,i,m,v,b,y=W[e[4]]+"";return{c(){t=r("div"),s=r("div"),o=r("span"),i=l("●"),m=n(),v=r("span"),b=l(y),this.h()},l(e){t=a(e,"DIV",{class:!0});var r=c(t);s=a(r,"DIV",{class:!0});var n=c(s);o=a(n,"SPAN",{class:!0});var l=c(o);i=d(l,"●"),l.forEach(h),m=u(n),v=a(n,"SPAN",{class:!0});var f=c(v);b=d(f,y),f.forEach(h),n.forEach(h),r.forEach(h),this.h()},h(){f(o,"class",K+" text-blue-500 text-2xl"),f(v,"class",K+" text-white text-sm"),f(s,"class","relative"),f(t,"class",K)},m(e,r){g(e,t,r),p(t,s),p(s,o),p(o,i),p(s,m),p(s,v),p(v,b)},p(e,t){16&t[0]&&y!==(y=W[e[4]]+"")&&w(b,y)},d(e){e&&h(t)}}}function _(e){let t,s,o,l=e[28]===e[1].startPos.row&&e[31]===e[1].startPos.col&&B(),i=e[28]===e[1].goalPos.row&&e[31]===e[1].goalPos.col&&U(),d=e[28]===e[3].row&&e[31]===e[3].col&&H(e);return{c(){t=r("div"),l&&l.c(),s=n(),i&&i.c(),o=n(),d&&d.c(),this.h()},l(e){t=a(e,"DIV",{class:!0});var r=c(t);l&&l.l(r),s=u(r),i&&i.l(r),o=u(r),d&&d.l(r),r.forEach(h),this.h()},h(){f(t,"class","relative w-10 h-10 bg-gray-200 box-border border border-gray-300"),x(t,"border-r-2",e[29].r),x(t,"border-r-black",e[29].r),x(t,"border-b-2",e[29].b),x(t,"border-b-black",e[29].b)},m(e,r){g(e,t,r),l&&l.m(t,null),p(t,s),i&&i.m(t,null),p(t,o),d&&d.m(t,null)},p(e,r){e[28]===e[1].startPos.row&&e[31]===e[1].startPos.col?l?l.p(e,r):(l=B(),l.c(),l.m(t,s)):l&&(l.d(1),l=null),e[28]===e[1].goalPos.row&&e[31]===e[1].goalPos.col?i?i.p(e,r):(i=U(),i.c(),i.m(t,o)):i&&(i.d(1),i=null),e[28]===e[3].row&&e[31]===e[3].col?d?d.p(e,r):(d=H(e),d.c(),d.m(t,null)):d&&(d.d(1),d=null)},d(e){e&&h(t),l&&l.d(),i&&i.d(),d&&d.d()}}}function q(e){let t,s,o=G(e[26]),l=[];for(let r=0;r<o.length;r+=1)l[r]=_(A(e,o,r));return{c(){t=r("div");for(let e=0;e<l.length;e+=1)l[e].c();s=n(),this.h()},l(e){t=a(e,"DIV",{class:!0});var o=c(t);for(let t=0;t<l.length;t+=1)l[t].l(o);s=u(o),o.forEach(h),this.h()},h(){f(t,"class","flex")},m(e,o){g(e,t,o);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(t,null);p(t,s)},p(e,r){if(282&r[0]){let n;for(o=G(e[26]),n=0;n<o.length;n+=1){const a=A(e,o,n);l[n]?l[n].p(a,r):(l[n]=_(a),l[n].c(),l[n].m(t,s))}for(;n<l.length;n+=1)l[n].d(1);l.length=o.length}},d(e){e&&h(t),b(l,e)}}}function J(e){let t,s,o=e[2]+"";return{c(){t=r("span"),s=l(o),this.h()},l(e){t=a(e,"SPAN",{class:!0});var r=c(t);s=d(r,o),r.forEach(h),this.h()},h(){f(t,"class","block border border-gray-200 rounded-sm font-pixel10")},m(e,o){g(e,t,o),p(t,s)},p(e,t){1&t[0]&&o!==(o=e[2]+"")&&w(s,o)},d(e){e&&h(t)}}}function Y(e){let t,s,x,k,S,E,T,O,R,M,W,L,A,B,U,H,_,Y,K,Q,X,Z,ee,te,se,oe,re,ne,le,ae,ce,ie,ue,he,de,fe,ge,pe,me,ve,we,be,ye,xe,ke='<strong class="cIndexSpan">Maze</strong>',Se="Code Editor",Ee=e[6]?"Stop":"Execute",Ce="Turns:",Ie="Logs",Pe=G(e[8]),De=[];for(let o=0;o<Pe.length;o+=1)De[o]=q(z(e,Pe,o));function je(t){e[13](t)}let $e={cLanguage:"language-javascript"};void 0!==e[0].code&&($e.code=e[0].code),_=new N({props:$e}),o.push((()=>C(_,"code",je)));let Ve=G(e[0].logs),Ge=[];for(let o=0;o<Ve.length;o+=1)Ge[o]=J(F(e,Ve,o));return{c(){t=r("div"),s=r("div"),x=r("div"),k=r("div"),S=r("div"),S.innerHTML=ke,E=n(),T=r("div");for(let e=0;e<De.length;e+=1)De[e].c();O=n(),R=r("div"),M=r("div"),W=r("div"),L=r("div"),A=r("strong"),A.textContent=Se,B=n(),U=r("button"),U.textContent="✕",H=n(),I(_.$$.fragment),K=n(),Q=r("div"),X=r("button"),Z=r("div"),ee=r("span"),te=l(Ee),se=n(),oe=r("div"),re=r("div"),ne=r("div"),le=r("div"),ae=r("strong"),ae.textContent=Ce,ce=n(),ie=r("span"),ue=l(e[5]),he=n(),de=r("div"),fe=r("div"),ge=r("strong"),ge.textContent=Ie,pe=n(),me=r("button"),me.textContent="✕",ve=n(),we=r("div");for(let e=0;e<Ge.length;e+=1)Ge[e].c();this.h()},l(o){t=a(o,"DIV",{class:!0});var r=c(t);s=a(r,"DIV",{class:!0});var n=c(s);x=a(n,"DIV",{class:!0});var l=c(x);k=a(l,"DIV",{});var f=c(k);S=a(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1a9scvh"!==i(S)&&(S.innerHTML=ke),E=u(f),T=a(f,"DIV",{class:!0});var g=c(T);for(let e=0;e<De.length;e+=1)De[e].l(g);g.forEach(h),f.forEach(h),l.forEach(h),n.forEach(h),O=u(r),R=a(r,"DIV",{class:!0});var p=c(R);M=a(p,"DIV",{class:!0});var m=c(M);W=a(m,"DIV",{});var v=c(W);L=a(v,"DIV",{class:!0});var w=c(L);A=a(w,"STRONG",{class:!0,"data-svelte-h":!0}),"svelte-1lke8zs"!==i(A)&&(A.textContent=Se),B=u(w),U=a(w,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),"svelte-1v3143d"!==i(U)&&(U.textContent="✕"),w.forEach(h),H=u(v),P(_.$$.fragment,v),v.forEach(h),K=u(m),Q=a(m,"DIV",{class:!0});var b=c(Q);X=a(b,"BUTTON",{type:!0,class:!0});var y=c(X);Z=a(y,"DIV",{class:!0});var C=c(Z);ee=a(C,"SPAN",{});var I=c(ee);te=d(I,Ee),I.forEach(h),C.forEach(h),y.forEach(h),b.forEach(h),m.forEach(h),p.forEach(h),se=u(r),oe=a(r,"DIV",{class:!0});var D=c(oe);re=a(D,"DIV",{class:!0});var j=c(re);ne=a(j,"DIV",{});var $=c(ne);le=a($,"DIV",{class:!0});var V=c(le);ae=a(V,"STRONG",{"data-svelte-h":!0}),"svelte-bln84g"!==i(ae)&&(ae.textContent=Ce),ce=u(V),ie=a(V,"SPAN",{});var G=c(ie);ue=d(G,e[5]),G.forEach(h),V.forEach(h),$.forEach(h),he=u(j),de=a(j,"DIV",{});var N=c(de);fe=a(N,"DIV",{class:!0});var F=c(fe);ge=a(F,"STRONG",{class:!0,"data-svelte-h":!0}),"svelte-r5pkvh"!==i(ge)&&(ge.textContent=Ie),pe=u(F),me=a(F,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),"svelte-24816r"!==i(me)&&(me.textContent="✕"),F.forEach(h),ve=u(N),we=a(N,"DIV",{class:!0});var z=c(we);for(let e=0;e<Ge.length;e+=1)Ge[e].l(z);z.forEach(h),N.forEach(h),j.forEach(h),D.forEach(h),r.forEach(h),this.h()},h(){f(S,"class","flex justify-between ml-2"),f(T,"class","bg-gray-400 border border-gray-500 p-4"),f(x,"class","flex flex-col justify-center items-center"),f(s,"class","col-span-1"),f(A,"class","cIndexSpan"),f(U,"type","submit"),f(U,"class","relative z-30"),f(L,"class","flex justify-between ml-2"),f(Z,"class","cButtonSpan"),f(X,"type","submit"),f(X,"class","cIconButtonStyle relative"),f(Q,"class","pt-2"),f(M,"class","flex flex-col justify-center items-center space-y-1"),f(R,"class","col-span-1"),f(le,"class","flex justify-between ml-2 space-x-1"),f(ge,"class","cIndexSpan"),f(me,"type","submit"),f(me,"class","relative z-30"),f(fe,"class","flex justify-between ml-2"),f(we,"class","w-96 h-40 p-4 border border-gray-500 bg-gray-100 rounded-md space-y-1 overflow-y-auto"),f(re,"class","flex flex-col justify-cetnter items-center space-y-1"),f(oe,"class","col-span-1"),f(t,"class","grid grid-cols-1 lg:grid-cols-3 justify-center items-top gap-4 m-4")},m(o,r){g(o,t,r),p(t,s),p(s,x),p(x,k),p(k,S),p(k,E),p(k,T);for(let e=0;e<De.length;e+=1)De[e]&&De[e].m(T,null);p(t,O),p(t,R),p(R,M),p(M,W),p(W,L),p(L,A),p(L,B),p(L,U),p(W,H),D(_,W,null),p(M,K),p(M,Q),p(Q,X),p(X,Z),p(Z,ee),p(ee,te),p(t,se),p(t,oe),p(oe,re),p(re,ne),p(ne,le),p(le,ae),p(le,ce),p(le,ie),p(ie,ue),p(re,he),p(re,de),p(de,fe),p(fe,ge),p(fe,pe),p(fe,me),p(de,ve),p(de,we);for(let e=0;e<Ge.length;e+=1)Ge[e]&&Ge[e].m(we,null);e[14](we),be=!0,ye||(xe=[m(U,"click",e[10]),m(X,"click",e[9]),m(me,"click",e[11])],ye=!0)},p(e,t){if(282&t[0]){let s;for(Pe=G(e[8]),s=0;s<Pe.length;s+=1){const o=z(e,Pe,s);De[s]?De[s].p(o,t):(De[s]=q(o),De[s].c(),De[s].m(T,null))}for(;s<De.length;s+=1)De[s].d(1);De.length=Pe.length}const s={};if(!Y&&1&t[0]&&(Y=!0,s.code=e[0].code,v((()=>Y=!1))),_.$set(s),(!be||64&t[0])&&Ee!==(Ee=e[6]?"Stop":"Execute")&&w(te,Ee),(!be||32&t[0])&&w(ue,e[5]),1&t[0]){let s;for(Ve=G(e[0].logs),s=0;s<Ve.length;s+=1){const o=F(e,Ve,s);Ge[s]?Ge[s].p(o,t):(Ge[s]=J(o),Ge[s].c(),Ge[s].m(we,null))}for(;s<Ge.length;s+=1)Ge[s].d(1);Ge.length=Ve.length}},i(e){be||(j(_.$$.fragment,e),be=!0)},o(e){$(_.$$.fragment,e),be=!1},d(s){s&&h(t),b(De,s),V(_),b(Ge,s),e[14](null),ye=!1,y(xe)}}}const K="absolute inset-0 flex items-center justify-center";function Q(e,t,s){const r=new L(60);let{codeExeProps:n}=t,{mazeSetting:l}=t;const a=l.mazeMatrix.map((e=>e.map(R)));let c=l.startPos,i=l.initialDirection,u=0;const h={log:{func:d,wait:0},stepForward:{func:f,wait:1e3},turnRight:{func:function(){s(4,i=g("right",i)),s(5,u++,u)},wait:1e3},turnLeft:{func:function(){s(4,i=g("left",i)),s(5,u++,u)},wait:1e3},turnAround:{func:function(){s(4,i=g("around",i)),s(5,u++,u)},wait:1e3}};function d(e){const t=`[${(new Date).toLocaleTimeString()}] ${e}`;s(0,n.logs=[...n.logs,t],n),v&&v.scrollTo({top:v.scrollHeight,behavior:"smooth"})}function f(){var e;const t={up:{row:-1,col:0,wall:"b",checkCurrentCell:!1},down:{row:1,col:0,wall:"b",checkCurrentCell:!0},left:{row:0,col:-1,wall:"r",checkCurrentCell:!1},right:{row:0,col:1,wall:"r",checkCurrentCell:!0}}[i],o=c.row+t.row,n=c.col+t.col,h=a[c.row][c.col],f=null==(e=a[o])?void 0:e[n];o>=0&&o<a.length&&n>=0&&n<a[0].length&&(t.checkCurrentCell?!h[t.wall]:!f[t.wall])?s(3,c={row:o,col:n}):d(`stepForward(): Can't move ${i}.`),c.row===l.goalPos.row&&c.col===l.goalPos.col&&(d("Reached Goal!"),m.trigger(O("Goal!!","Succeed")),s(6,p=!1),r.terminate()),s(5,u++,u)}function g(e,t){const s=Object.values(M),o=s.indexOf(t);return s[(o+("around"===e?2:"right"===e?1:-1)+s.length)%s.length]}let p=!1;const m=T();let v;return e.$$set=e=>{"codeExeProps"in e&&s(0,n=e.codeExeProps),"mazeSetting"in e&&s(1,l=e.mazeSetting)},[n,l,d,c,i,u,p,v,a,function(){p?(s(6,p=!1),r.terminate()):(s(6,p=!0),r.run(n.code,{...h},(e=>{s(0,n.resultString=e.resultString,n),m.trigger(O(e.message,e.status)),s(6,p=!1)})))},function(){s(0,n.code="",n)},function(){s(0,n.logs=[],n)},f,function(t){e.$$.not_equal(n.code,t)&&(n.code=t,s(0,n))},function(e){o[e?"unshift":"push"]((()=>{v=e,s(7,v)}))}]}class X extends S{constructor(e){super(),E(this,e,Q,Y,s,{codeExeProps:0,mazeSetting:1,log:2,stepForward:12},null,[-1,-1])}get log(){return this.$$.ctx[2]}get stepForward(){return this.$$.ctx[12]}}export{M as D,X as L};
